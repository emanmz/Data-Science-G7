---
title: "Regression Analysis"
author: "Group 7"
date: "2023-10-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
data = read.csv("~/Data-Science-G7/CopyOfBarton_Springs_Salamanders_DO_and_Flow.csv")
```

```{r}
#  a subset with only relevant columns for DISSOLVED OXYGEN
dissolved_oxygen_data <- data[data$PARAMETER == "DISSOLVED OXYGEN" & data$UNIT == "MG/L", c("WATERSHED", "SAMPLE_DATE", "SITE_NAME", "QUALIFIER", "RESULT", "UNIT")]

# Load the ggplot2 library if not already installed
if (!require(ggplot2)) {
  install.packages("ggplot2")
  library(ggplot2)
}

# Convert RESULT to logarithmic scale
total_salamander_data$LOG_RESULT <- log(total_salamander_data$RESULT)
# Filter out zero or negative values
total_salamander_data <- total_salamander_data[total_salamander_data$RESULT > 0, ]

# Create an exponential regression model
exp_model <- lm(LOG_RESULT ~ SITE_NAME, data = total_salamander_data)

# Summary of the exponential regression
summary(exp_model)

# Plotting the exponential regression
gg_exp <- ggplot(total_salamander_data, aes(x = SITE_NAME, y = RESULT)) +
  geom_point() +
  geom_smooth(method = "lm", formula = y ~ exp(x), se = FALSE, color = "red") +
  labs(title = "Exponential Regression Plot of Salamander Count by Site Name",
       x = "Site Name",
       y = "Salamander Count (log scale)") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Save the ggplot as a PNG file
ggsave("salamander_exponential_regression_plot.png", gg_exp, width = 10, height = 6, units = "in")



```
```{r}
#  categorical variables to factors
dissolved_oxygen_data$WATERSHED <- as.factor(dissolved_oxygen_data$WATERSHED)
dissolved_oxygen_data$SITE_NAME <- as.factor(dissolved_oxygen_data$SITE_NAME)
dissolved_oxygen_data$UNIT <- as.factor(dissolved_oxygen_data$UNIT)
dissolved_oxygen_data$RESULT <- as.numeric(dissolved_oxygen_data$RESULT)

# standardize numerical predictors
dissolved_oxygen_data$SAMPLE_DATE <- scale(dissolved_oxygen_data$SAMPLE_DATE)
#  logistic regression with polynomial terms
model_logistic <- glm(BINARY_OUTCOME ~ poly(SAMPLE_DATE, degree = 2), data = dissolved_oxygen_data, family = "binomial", maxit = 1000)


# Fit a logistic regression model
# Try different optimization methods
model_logistic <- glm(BINARY_OUTCOME ~ SAMPLE_DATE, data = dissolved_oxygen_data, family = "binomial", control = list(maxit = 1000))

# Load the ggplot2 library if not already installed
if (!require(ggplot2)) {
  install.packages("ggplot2")
  library(ggplot2)
}

# Scatter plot with a logistic regression line
plot_logistic <- ggplot(dissolved_oxygen_data, aes(x = SAMPLE_DATE, y = BINARY_OUTCOME)) +
  geom_point() +
  geom_smooth(method = "glm", method.args = list(family = "binomial"), se = FALSE, color = "green") +
  labs(title = "Scatter Plot with Logistic Regression Line",
       x = "SAMPLE_DATE",
       y = "BINARY_OUTCOME") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
# Diagnostic plot
plot(model_logistic)

# Save the plot as a PNG file
ggsave("scatter_plot_logistic_regression_line.png", plot_logistic, width = 10, height = 6, units = "in")

# Summary statistics for the logistic model
summary(model_logistic)





```
```{r}
library(openxlsx)

data2 = read.xlsx("~/Data-Science-G7/Average Dissolved Oxygen Per Year.xlsx")

library(ggplot2)

ggplot(data2, aes(x = YEAR, y = average_dissolved_oxygen)) +
  geom_line(color = "blue") +
  geom_point(color = "blue") +
  labs(x = "Year", y = "Average Dissolved Oxygen", 
       title = "Average Dissolved Oxygen Over the Years")

```
```{r}
# Fit a linear regression model
linear_model <- lm(average_dissolved_oxygen ~ YEAR, data = data2)

# Display the summary of the linear model
summary(linear_model)

# Visualize the linear regression line along with the data points
ggplot(data2, aes(x = YEAR, y = average_dissolved_oxygen)) +
  geom_point(color = "blue") +
  geom_smooth(method = "lm", se = FALSE, color = "red", formula = y ~ x) +
  labs(x = "Year", y = "Average Dissolved Oxygen", 
       title = "Linear Regression: Average Dissolved Oxygen Over the Years")
```
```{r}
# Fit a quadratic polynomial regression model
quadratic_model <- lm(average_dissolved_oxygen ~ poly(YEAR, 2), data = data2)

# Display the summary of the quadratic model
summary(quadratic_model)

# Generate a sequence of values for plotting the regression curve
year_seq <- seq(min(data2$YEAR), max(data2$YEAR), length.out = 100)

# Predict the average dissolved oxygen using the quadratic model
predicted_values <- predict(quadratic_model, newdata = data.frame(YEAR = year_seq))

# Create a data frame for plotting
plot_data <- data.frame(YEAR = year_seq, predicted_values = predicted_values)

# Visualize the quadratic regression curve along with the data points
ggplot() +
  geom_point(data = data2, aes(x = YEAR, y = average_dissolved_oxygen), color = "blue") +
  geom_line(data = plot_data, aes(x = YEAR, y = predicted_values), color = "red") +
  labs(x = "Year", y = "Average Dissolved Oxygen", 
       title = "Quadratic Polynomial Regression: Average Dissolved Oxygen Over the Years")

```
```{r}
#   exponential regression model
exp_model <- lm(log(average_dissolved_oxygen) ~ YEAR, data = data2)

# summary of the exponential model
summary(exp_model)

# Generate predicted values using the exponential model
predicted_values <- exp(predict(exp_model, newdata = data2))

# exponential regression curve along with the data points
ggplot(data2, aes(x = YEAR, y = average_dissolved_oxygen)) +
  geom_point(color = "blue") +
  geom_line(aes(x = YEAR, y = predicted_values), color = "red") +
  labs(x = "Year", y = "Average Dissolved Oxygen", 
       title = "Exponential Regression: Average Dissolved Oxygen Over the Years")

```
```{r}
library(mgcv)
gam_model <- gam(average_dissolved_oxygen ~ s(YEAR), data = data2)
summary(gam_model)
plot(gam_model, se = TRUE, col = "blue", main = "GAM: Smooth Term per YEAR")

```

